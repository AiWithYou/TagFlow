# 画像タグ付け・ファイル移動ツール

AIモデルを使用して画像にタグ付けし、タグに基づいて画像ファイルを管理するためのツールです。

## 主な機能

### 画像タグ付け機能
- Ollamaを利用したAIによる画像分析
- 画像ファイルのドラッグ＆ドロップ対応
- 画像のサムネイルプレビュー表示
- 分析結果のタグ表示
- 削除パターン設定GUI（パターンテスト機能付き）
- AIチャット機能（最新メッセージ自動表示）

### ファイル移動機能
- タグに基づく画像検索（AND/OR条件対応）
- 正規表現によるキーワード検索
- 検索結果のプレビュー表示
- 選択した画像のコピー/移動機能

## 動作環境
- Python 3.8以上
- PySide6
- Pillow (PIL)
- Pillow-HEIF (HEIC画像対応、オプション)
- Ollama（ローカルで実行）

## インストール方法

```bash
# 必要なパッケージのインストール
pip install PySide6 Pillow requests pillow-heif
```

## 使用方法

### アプリケーションの起動
```bash
python main_new.py
```

### 画像タグ付け
1. 「画像タグ付け」タブを選択
2. 画像ファイルをウィンドウにドラッグ＆ドロップするか、「フォルダ追加」または「ファイル追加」ボタンで追加
3. Ollamaモデルと言語を選択（デフォルトは「gemma3:27b」）
4. 必要に応じて「詳細設定」ボタンからカスタムプロンプトや詳細度を設定
5. 「分析実行」ボタンをクリックして処理を開始
6. 分析結果は画像と同じフォルダに.txtファイルとして保存されます

### 削除パターン設定
1. メニューバー「設定」→「削除パターン設定」を選択
2. 初期クリーニングパターンと追加クリーニングパターンを編集
3. 「パターンテスト」ボタンで実際のテキストに対する効果を確認

### ファイル移動
1. 「ファイル移動」タブを選択
2. 「ソースフォルダ」と「宛先フォルダ」を選択
3. 検索キーワードを入力（カンマ区切りで複数指定可能）
4. 検索モード（AND/OR）と正規表現オプションを設定
5. 「検索」ボタンをクリックして検索を実行
6. 検索結果から対象の画像を選択
7. 「コピー」または「移動」ボタンをクリックして処理を実行

## カスタマイズ

### Ollama URL
デフォルトでは「http://localhost:11434/api/generate」を使用しますが、ツールバーのURL入力欄で変更可能です。

### モデル選択
デフォルトでは「gemma3:27b」を使用しますが、ドロップダウンメニューから選択するか、直接入力で変更可能です。

### カスタムプロンプト
「詳細設定」ボタンからカスタムプロンプトを設定できます。空白の場合はデフォルトプロンプトが使用されます。

## 注意事項
- Ollamaが事前にインストールされている必要があります
- 大量の画像を処理する場合は、処理時間がかかる場合があります
- 画像分析の精度はOllamaのモデルに依存します
- HEIC画像を扱う場合はpillow-heifのインストールが必要です

## exe化について
PyInstallerを使用してexe化する場合は以下のコマンドを実行します：

```bash
pip install pyinstaller
pyinstaller --onefile --windowed --icon=app_icon.ico main_new.py
```

## ライセンス
このソフトウェアは商用利用可能です。


## ユースケース集

### 機能別ユースケース

| 機能 | 典型的ユースケース | 作業時間の短縮例 |
|------|------------------|------------------|
| AI 画像タグ付け | SNS 投稿前に数百枚の写真へ自動タグ付け | 撮影 → 公開までのタグ付け工数を **90% 削減** |
| タグ検索 + 一括コピー | 「sunset, beach」タグの写真だけフォトフレーム用フォルダにコピー | 手作業での選別を **秒速化** |
| タグ検索 + 一括移動 | 顔写真を自動仕分けしてプライベート領域へ移動 | 誤公開リスクをゼロに |
| TXT 一括編集 | 描画 AI 学習用タグを一括正規化 (`cat`→`cat_(animal)`) | データクリーニング時間を **1/5** |
| AI チャット | Ollama × 自社ローカル LLM でタグルールを相談 | オフライン環境でも **セキュアに質問** |
| 削除パターン GUI | LLM が生成する冗長フレーズをワンクリックで除去 | 後工程スクリプトの入力整形が不要 |
| AI サーバ自動起動 | `ollama serve` が未起動でもボタン一つで起動 | 端末再起動後の**手間ゼロ** |

### シナリオ例

- **商品画像の一括 EC 登録**：タグ → 検索 → 移動 → ZIP化まで自動化
- **旅行写真アルバム作成**：自動タグでアルバム別に自動分類
- **AI学習データ整備**：タグ付け済みデータの統一とバランス調整
- **過去SNS投稿の再利用**：画像 + タグ + Chatでハッシュタグ改善
- **社内データ保護**：顔写真を検出・自動でアクセス制限領域へ
